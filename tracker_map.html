<html>
<head>
<title>ALTTP Randomizer Door Tracker</title>

<link rel="stylesheet" href="styles.css">
<link rel="icon" type="image/png" href="images/triforce.png">

<script src="script/helper.js"></script>
<script src="script/options.js"></script>
<script src="script/struct.js"></script>
<script src="script/ui.js"></script>
<script src="script/special.js"></script>

</head>

<body style="background-color:rgb(0,0,0); color:white; font-family:'Tahoma',Times,serif">

<script>
//disable right clicking (because we are using right clicks for other things)
window.oncontextmenu = function () { return false; }
//disable middle scroll (because we are using middle clicks for other things)
document.body.onmousedown = function(e) { if (e.button === 1) return false; }

resetAll(); //initialize data structures


const NUM_MAP_COLUMNS = 5;
const NUM_ICON_COLUMNS = 14;

//px settings
const ROOM_SIZE = 64;
const ROOM_PADDING = 32;
const EXIT_SIZE = 16;
const DUNGEON_WINDOW_WIDTH = 40;
const DUNGEON_SCRATCH_WIDTH = 38;
const MAP_OFFSET_Y = 1;
const ICON_WIN_X = 0;
const ICON_WIN_Y = DUNGEON_WINDOW_WIDTH * 13;
const ICON_SIZE = 45;
const MAP_SIZE = (ROOM_SIZE * NUM_MAP_COLUMNS) + ROOM_PADDING * (NUM_MAP_COLUMNS + 1)
const SPEC_BLOWUP_SIZE = 96;
const SPEC_BLOWUP_PADDING = 5;
const SPEC_BLOWUP_BORDER = 1;

const IMG_CANVAS_SCALE = 2;
const ROOM_COLOR = "rgb(57,123,231)";
const EXIT_COLOR = "rgb(255,255,255)";
const DUNGEON_BORDER_COLOR = "dimgray";
const SPEC_BLOWUP_ALPHA = 0.9;
const USELESS_TILE_OPACITY = 67; //%

//Dungeon level select
document.write("<table id='dungeons' class='noselect' style='border-spacing:0px; position:absolute; top:0px; left:0px; height:"+(DUNGEON_WINDOW_WIDTH*13)+"px; width:"+(DUNGEON_WINDOW_WIDTH+DUNGEON_SCRATCH_WIDTH)+"px'>");
	for (var j = 0; j < 13; j++) {
		document.write("<tr id='dungrow"+j+"' class='dungeontext' style='box-shadow:inset -1px -1px 0px 0px "+DUNGEON_BORDER_COLOR+"'>");
			document.write("<td id='dung"+j+"' class='noselect' style='vertical-align:bottom; text-align:right; direction:rtl; padding-right:2px; font-size:12px; background-image:url(\"images/dung"+j+".png\"); background-size:100% 100%; width:"+DUNGEON_WINDOW_WIDTH+"px; height:"+DUNGEON_WINDOW_WIDTH+"px'></td>");
			document.write("<td id='scratch"+j+"' class='noselect' style='vertical-align:bottom; text-align:right; direction:rtl; padding-right:2px; font-size:12px; width:"+DUNGEON_SCRATCH_WIDTH+"px; height:"+DUNGEON_WINDOW_WIDTH+"px'></td>");
		document.write("</tr>");
		document.getElementById("dung"+j).innerHTML = DUNG_ABBREV[j];
	}
document.write("</table>");
document.getElementById("dungrow0").style.backgroundColor = DUNGEON_HIGHLIGHT

/*
//Dungeon scratch space
document.write("<table id='scratch' class='noselect' style='box-shadow:inset 0px 0px 0px 1px dimgray; border-spacing:0px; position:absolute; top:0px; left:"+DUNGEON_WINDOW_WIDTH+"px; height:"+(DUNGEON_WINDOW_WIDTH*13)+"px; width:"+DUNGEON_SCRATCH_WIDTH+"px'>");
	for (var j = 0; j < 13; j++) {
		document.write("<tr class='dungeontext'><td id='scratch"+j+"' class='noselect' style='vertical-align:bottom; text-align:right; direction:rtl; padding-right:2px; font-size:12px; width:"+DUNGEON_SCRATCH_WIDTH+"px; height:"+DUNGEON_WINDOW_WIDTH+"px'>");
		document.write("</td></tr>");
	}
document.write("</table>");*/

//Room tracker
document.write("<table id='mapper' class='noselect' style='background-image:url(\"images/mapper.png\"); background-size:100% 100%; border-spacing:"+ROOM_PADDING+"px; position:absolute; top:"+MAP_OFFSET_Y+"px; left:"+(DUNGEON_WINDOW_WIDTH+DUNGEON_SCRATCH_WIDTH)+"px; height:"+MAP_SIZE+"px; width:"+MAP_SIZE+"px'>");
for (var j = 0; j < ROOM_NUM; j++) {
	if (j % NUM_MAP_COLUMNS === 0) document.write("<tr class='noselect'>");
		document.write("<td id='room"+j+"' class='noselect' style='opacity:0; background-size:100% 100%; background-color:"+ROOM_COLOR+"; position:relative; width:"+ROOM_SIZE+"px; height:"+ROOM_SIZE+"px'>");
			for (var i = 0; i < EXIT_NUM; i++) {
				document.write("<div id='exit"+j+"_"+i+"' class='noselect' style='box-shadow:inset 0px 0px 0px 1px black; background-size:100% 100%; background-color:"+EXIT_COLOR+"; position:absolute; height:"+EXIT_SIZE+"px; width:"+EXIT_SIZE+"px'></div>");
				exitcoord = translateExitPos(i);
				document.getElementById("exit"+j+"_"+i).style.left = exitcoord.x+"px";
				document.getElementById("exit"+j+"_"+i).style.top = exitcoord.y+"px";
			}
		document.write("</td>");
	if ((j+1) % NUM_MAP_COLUMNS === 0) document.write("</tr>");
}
document.write("</table>");

//right side special icons
document.write("<table id='special' class='noselect' style='border-spacing:0px; position:absolute; top:0px; left:"+(DUNGEON_WINDOW_WIDTH+DUNGEON_SCRATCH_WIDTH+MAP_SIZE)+"px; height:"+(DUNGEON_WINDOW_WIDTH*13)+"px; width:"+DUNGEON_WINDOW_WIDTH+"px'>");
	for (var j = 0; j < 13; j++) {
		document.write("<tr class='dungeontext'><td id='spec"+j+"' class='noselect' style='vertical-align:bottom; text-align:right; direction:rtl; padding-right:2px; font-size:12px; background-image:url(\"images/"+specData[j].rooms[0].img+".png\"); background-size:100% 100%; width:"+DUNGEON_WINDOW_WIDTH+"px; height:"+DUNGEON_WINDOW_WIDTH+"px'>");
		document.write("</td></tr>");
		document.getElementById("spec"+j).innerHTML = SPEC_TEXT[j];
	}
document.write("</table>");

//Icons for image placement
var iconWinHeight = ICON_SIZE * (parseInt((ICON_NAMES.length - 1) / NUM_ICON_COLUMNS) + 1);
document.write("<table id='iconography' class='noselect' style='border-spacing:0px; position:absolute; top:"+ICON_WIN_Y+"px; left:"+ICON_WIN_X+"px; height:"+iconWinHeight+"px; width:"+ICON_SIZE*NUM_ICON_COLUMNS+"px'>");
for (var j = 0; j < ICON_NAMES.length; j++) {
	if (j % NUM_ICON_COLUMNS === 0) document.write("<tr class='noselect'>");
		document.write("<td id='icon"+j+"' class='noselect' style='background-image:url(\"images/"+ICON_NAMES[j]+".png\"); background-size:100% 100%; position:relative'></td>");
	if ((j+1) % NUM_ICON_COLUMNS === 0) document.write("</tr>");
}
document.write("</table>");

//Canvas size to fill entire window
var canvasWidth = Math.max(DUNGEON_WINDOW_WIDTH + DUNGEON_SCRATCH_WIDTH + MAP_SIZE + DUNGEON_WINDOW_WIDTH, ICON_SIZE * NUM_ICON_COLUMNS);
var canvasHeight = ICON_WIN_Y + iconWinHeight;

//Canvas for static images
document.write("<div class='noselect' style='position:absolute; top:0px; left:0px'>");
	document.write("<canvas id='imgCanvas' width='"+canvasWidth*IMG_CANVAS_SCALE+"px' height='"+canvasHeight*IMG_CANVAS_SCALE+"px' style='width:"+canvasWidth+"px; height:"+canvasHeight+"px'></canvas>");
document.write("</div>");

//Canvas for drawing dynamic lines
document.write("<div class='noselect' style='position:absolute; top:0px; left:0px; cursor:inherit; z-index:1'>");
	document.write("<canvas id='myCanvas' width='"+canvasWidth+"px' height='"+canvasHeight+"px'></canvas>");
document.write("</div>");
document.getElementById("myCanvas").addEventListener("mousedown", trackerClick);
document.getElementById("myCanvas").addEventListener("mousemove", canvasMove); //update dynamic lines when moving
document.getElementById("myCanvas").addEventListener("mouseup", trackerRelease);
document.getElementById("myCanvas").addEventListener("wheel", mouseWheel);

//Invisible elements for catching mouse events
document.write("<table id='i_dungeons' class='noselect' style='border-spacing:0px; position:absolute; top:0px; left:0px; height:"+(DUNGEON_WINDOW_WIDTH*13)+"px; width:"+DUNGEON_WINDOW_WIDTH+"px; cursor:inherit; z-index:2'>");
	for (var j = 0; j < 13; j++) {
		document.write("<tr class='noselect style='cursor:inherit'><td id='i_dung"+j+"' class='noselect' style='width:"+DUNGEON_WINDOW_WIDTH+"px; height:"+DUNGEON_WINDOW_WIDTH+"px; cursor:inherit'>");
		document.write("</td></tr>");
	}
document.write("</table>");
document.getElementById("i_dungeons").addEventListener("mousedown", trackerClick);
document.getElementById("i_dungeons").addEventListener("mousemove", canvasMove); //update dynamic lines when moving
document.getElementById("i_dungeons").addEventListener("mouseup", trackerRelease);
document.getElementById("i_dungeons").addEventListener("wheel", mouseWheel);

document.write("<table id='i_scratch' class='noselect' style='border-spacing:0px; position:absolute; top:0px; left:"+DUNGEON_WINDOW_WIDTH+"px; height:"+(DUNGEON_WINDOW_WIDTH*13)+"px; width:"+DUNGEON_SCRATCH_WIDTH+"px; cursor:inherit; z-index:2'>");
	for (var j = 0; j < 13; j++) {
		document.write("<tr class='visibletext' style='cursor:inherit'><td id='i_scratch"+j+"' class='noselect' style='vertical-align:bottom; text-align:right; direction:rtl; padding-right:3px; font-size:12px; width:"+DUNGEON_SCRATCH_WIDTH+"px; height:"+DUNGEON_WINDOW_WIDTH+"px; cursor:inherit'>");
		document.write("</td></tr>");
		updateDungeonCounterText(j);
	}
document.write("</table>");
document.getElementById("i_scratch").addEventListener("mousedown", trackerClick);
document.getElementById("i_scratch").addEventListener("mousemove", canvasMove); //update dynamic lines when moving
document.getElementById("i_scratch").addEventListener("mouseup", trackerRelease);
document.getElementById("i_scratch").addEventListener("wheel", mouseWheel);

document.write("<table id='i_mapper' class='noselect' style='border-spacing:"+ROOM_PADDING+"px; position:absolute; top:"+MAP_OFFSET_Y+"px; left:"+(DUNGEON_WINDOW_WIDTH+DUNGEON_SCRATCH_WIDTH)+"px; height:"+MAP_SIZE+"px; width:"+MAP_SIZE+"px; cursor:inherit; z-index:2'>");
for (var j = 0; j < ROOM_NUM; j++) {
	if (j % NUM_MAP_COLUMNS === 0) document.write("<tr class='noselect' style='cursor:inherit'>");
		document.write("<td id='i_room"+j+"' class='noselect' style='position:relative; width:"+ROOM_SIZE+"px; height:"+ROOM_SIZE+"px; cursor:inherit'>");
			for (var i = 0; i < EXIT_NUM; i++) {
				document.write("<div id='i_exit"+j+"_"+i+"' class='noselect' style='position:absolute; height:"+EXIT_SIZE+"px; width:"+EXIT_SIZE+"px; cursor:inherit'></div>");
				exitcoord = translateExitPos(i);
				document.getElementById("i_exit"+j+"_"+i).style.left = exitcoord.x+"px";
				document.getElementById("i_exit"+j+"_"+i).style.top = exitcoord.y+"px";
			}
		document.write("</td>");
		document.getElementById("i_room"+j).addEventListener("mouseover", roomVisible);
		document.getElementById("i_room"+j).addEventListener("mouseout", roomVisible);
	if ((j+1) % NUM_MAP_COLUMNS === 0) document.write("</tr>");
}
document.write("</table>");
document.getElementById("i_mapper").addEventListener("mousedown", trackerClick);
document.getElementById("i_mapper").addEventListener("mousemove", canvasMove); //update dynamic lines when moving
document.getElementById("i_mapper").addEventListener("mouseup", trackerRelease);
document.getElementById("i_mapper").addEventListener("wheel", mouseWheel);

document.write("<table id='i_special' class='noselect' style='border-spacing:0px; position:absolute; top:0px; left:"+(DUNGEON_WINDOW_WIDTH+DUNGEON_SCRATCH_WIDTH+MAP_SIZE)+"px; height:"+(DUNGEON_WINDOW_WIDTH*13)+"px; width:"+DUNGEON_WINDOW_WIDTH+"px; cursor:inherit; z-index:2'>");
	for (var j = 0; j < 13; j++) {
		document.write("<tr class='noselect style='cursor:inherit'><td id='i_spec"+j+"' class='noselect' style='width:"+DUNGEON_WINDOW_WIDTH+"px; height:"+DUNGEON_WINDOW_WIDTH+"px; cursor:inherit'>");
		document.write("</td></tr>");
	}
document.write("</table>");
document.getElementById("i_special").addEventListener("mousedown", trackerClick);
document.getElementById("i_special").addEventListener("mousemove", canvasMove); //update dynamic lines when moving
document.getElementById("i_special").addEventListener("mouseup", trackerRelease);
document.getElementById("i_special").addEventListener("wheel", mouseWheel);

document.write("<table id='i_iconography' class='noselect' style='border-spacing:0px; position:absolute; top:"+ICON_WIN_Y+"px; left:"+ICON_WIN_X+"px; height:"+iconWinHeight+"px; width:"+ICON_SIZE*NUM_ICON_COLUMNS+"px; cursor:inherit; z-index:2'>");
for (var j = 0; j < ICON_NAMES.length; j++) {
	if (j % NUM_ICON_COLUMNS === 0) document.write("<tr class='noselect' style='cursor:inherit'>");
		document.write("<td id='i_icon"+j+"' class='noselect' style='position:relative; cursor:inherit'></td>");
	if ((j+1) % NUM_ICON_COLUMNS === 0) document.write("</tr>");
}
document.write("</table>");
document.getElementById("i_iconography").addEventListener("mousedown", trackerClick);
document.getElementById("i_iconography").addEventListener("mousemove", canvasMove); //update dynamic lines when moving
document.getElementById("i_iconography").addEventListener("mouseup", trackerRelease);
document.getElementById("i_iconography").addEventListener("wheel", mouseWheel);

//Popup overlays for tile selection
for (var j = 0; j < specData.length; j++) {
	if (specData[j].popup === true) {
		var topPos = j*DUNGEON_WINDOW_WIDTH;
		var leftPos = DUNGEON_WINDOW_WIDTH + DUNGEON_SCRATCH_WIDTH + MAP_SIZE - SPEC_BLOWUP_PADDING - specData[j].x * (SPEC_BLOWUP_SIZE+SPEC_BLOWUP_PADDING) - SPEC_BLOWUP_BORDER*2;
		var width = specData[j].x * (SPEC_BLOWUP_SIZE+SPEC_BLOWUP_PADDING) + SPEC_BLOWUP_PADDING + SPEC_BLOWUP_BORDER*2;
		var height = specData[j].y * (SPEC_BLOWUP_SIZE+SPEC_BLOWUP_PADDING) + SPEC_BLOWUP_PADDING + SPEC_BLOWUP_BORDER*2;
		if (topPos + height > ICON_WIN_Y + ICON_SIZE * (parseInt((ICON_NAMES.length-1) / NUM_ICON_COLUMNS)+1))
			topPos = (ICON_WIN_Y + ICON_SIZE * (parseInt((ICON_NAMES.length-1) / NUM_ICON_COLUMNS)+1)) - height;
		document.write("<table id='specpop"+j+"' class='noselect' style='padding:0px; background-color:rgba(0,0,0,"+SPEC_BLOWUP_ALPHA+"); display:none; border:"+SPEC_BLOWUP_BORDER+"px solid; border-spacing:"+SPEC_BLOWUP_PADDING+"px; position:absolute; top:"+topPos+"px; left:"+leftPos+"px; height:"+height+"px; width:"+width+"px; cursor:inherit; z-index:3'>");
			document.write("<tr class='dungeontext' style='cursor:inherit'>");
				for (var i = 0; i < specData[j].rooms.length; i++) {
					var x = specData[j].rooms[i].x * (SPEC_BLOWUP_SIZE+SPEC_BLOWUP_PADDING) + SPEC_BLOWUP_PADDING;
					var y = specData[j].rooms[i].y * (SPEC_BLOWUP_SIZE+SPEC_BLOWUP_PADDING) + SPEC_BLOWUP_PADDING;
					var opacity = (specData[j].rooms[i].high === true ? 100 : USELESS_TILE_OPACITY);
					document.write("<td id='specpop"+j+"_"+i+"' class='noselect' style='filter:brightness("+opacity+"%); padding:0px; background-image:url(\"images/"+specData[j].rooms[i].img+".png\"); background-size:100% 100%; position:absolute; width:"+SPEC_BLOWUP_SIZE+"px; height:"+SPEC_BLOWUP_SIZE+"px; top:"+y+"px; left:"+x+"px; cursor:inherit'></td>");
				}
			document.write("</tr>");
		document.write("</table>");
		document.getElementById("specpop"+j).addEventListener("wheel", mouseWheel);
		document.getElementById("specpop"+j).addEventListener("mousedown", trackerClick);
	}
}

//Chest Counter
document.write("<div id='chests' class='dungeontext' style='vertical-align:bottom; text-align:left; padding-left:2px; font-size:12px; position:absolute; top:10px; left:88px;'>");
document.write("</div>");
document.getElementById("chests").innerHTML = "";

//Options window
document.write("<div id='options' class='dungeontext' style='display:none; background:rgba(0,0,0,0.75); position:absolute; left:10px; top:10px; width:"+(canvasWidth-20)+"px; height:"+(canvasHeight-20)+"px; z-index:10'>");
	document.write("<div style='position:absolute; top:10px; left:10px; height:"+(canvasHeight-40)+"px; width:"+(canvasWidth-40)+"px; border:2px solid white'>");
		document.write("<h4 style='margin-top:-10px; margin-left:10px; background:black; padding:0px 5px; width:65px'>Options</h4>");
		document.write("&ensp;Key Drop Shuffle:");
		document.write("<input type='radio' id='opt_potsanity_on' checked name='potsanity' value='on' style='position:absolute; left:200px'>");
		document.write("<label for='on' style='position:absolute; left:220px'>On</label>");
		document.write("<input type='radio' id='opt_potsanity_off' name='potsanity' value='off' style='position:absolute; left:250px'>");
		document.write("<label for='off' style='position:absolute; left:270px'>Off</label><br><br>");
		document.write("&ensp;Dungeon Lobby Shuffle:");
		document.write("<input type='radio' id='opt_lobby_on' checked name='lobby' value='on' style='position:absolute; left:200px'>");
		document.write("<label for='on' style='position:absolute; left:220px'>On</label>");
		document.write("<input type='radio' id='opt_lobby_off' name='lobby' value='off' style='position:absolute; left:250px'>");
		document.write("<label for='off' style='position:absolute; left:270px'>Off</label><br><br>");
		document.write("&ensp;Show chest counter for all dungeons:");
		document.write("<input type='radio' id='opt_counter_on' name='counter' value='on' style='position:absolute; left:300px'>");
		document.write("<label for='on' style='position:absolute; left:320px'>On</label>");
		document.write("<input type='radio' id='opt_counter_off' checked name='counter' value='off' style='position:absolute; left:350px'>");
		document.write("<label for='off' style='position:absolute; left:370px'>Off</label><br><br>");
		document.write("&ensp;Allow exit modification on pre-defined tiles:");
		document.write("<input type='radio' id='opt_exit_enable' checked name='optexit' value='on' style='position:absolute; left:350px'>");
		document.write("<label for='on' style='position:absolute; left:370px'>On</label>");
		document.write("<input type='radio' id='opt_exit_disable' name='optexit' value='off' style='position:absolute; left:400px'>");
		document.write("<label for='off' style='position:absolute; left:420px'>Off</label><br><br>");
		document.write("&ensp;Allow icon deletion on right clicks:");
		document.write("<input type='radio' id='opt_eraseR_enable' name='eraseR' value='on' style='position:absolute; left:300px'>");
		document.write("<label for='on' style='position:absolute; left:320px'>On</label>");
		document.write("<input type='radio' id='opt_eraseR_disable' checked name='eraseR' value='off' style='position:absolute; left:350px'>");
		document.write("<label for='off' style='position:absolute; left:370px'>Off</label><br><br>");
		document.write("<input type='button' id='reset_button' value='Reset' onclick='button_click(this)' style='position:absolute; left:10px; top:250px'>");
		document.write("<input type='button' id='close_button' value='Close' onclick='button_click(this)' style='position:absolute; left:70px; top:250px'>");
	document.write("</div>");

document.write("</div>");

InitializeDungeonMaps();
refreshVisible();
drawImages();
</script>

</body>
</html>